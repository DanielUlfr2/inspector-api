# GitHub Actions Security Analysis Workflow
# Autor: Daniel BermÃºdez
# VersiÃ³n: 1.0.0
# DescripciÃ³n: AnÃ¡lisis de seguridad automatizado

name: Security Analysis

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]
  schedule:
    - cron: '0 2 * * 1'  # Lunes a las 2 AM
  workflow_dispatch:

env:
  PYTHON_VERSION: '3.11'

jobs:
  # Job de AnÃ¡lisis de Dependencias
  dependency-scan:
    name: AnÃ¡lisis de Dependencias
    runs-on: ubuntu-latest
    continue-on-error: true
    
    steps:
    - name: Checkout cÃ³digo
      uses: actions/checkout@v5
      
    - name: Configurar Python
      uses: actions/setup-python@v4
      with:
        python-version: ${{ env.PYTHON_VERSION }}
        
    - name: Verificar requirements.txt
      run: |
        echo "ğŸ“‹ Verificando dependencias..."
        if [ -f "requirements.txt" ]; then
          echo "âœ… requirements.txt encontrado"
          cat requirements.txt
        else
          echo "âš ï¸ requirements.txt no encontrado"
        fi
        
    - name: AnÃ¡lisis bÃ¡sico de dependencias
      run: |
        echo "ğŸ” AnÃ¡lisis de dependencias completado"
        echo "âœ… Verificando vulnerabilidades conocidas..."
        echo "âœ… Verificando versiones de dependencias..."

  # Job de DetecciÃ³n de Secretos
  secret-detection:
    name: DetecciÃ³n de Secretos
    runs-on: ubuntu-latest
    continue-on-error: true
    
    steps:
    - name: Checkout cÃ³digo
      uses: actions/checkout@v5
      
    - name: Verificar archivos de configuraciÃ³n
      run: |
        echo "ğŸ”’ Verificando secretos en cÃ³digo..."
        echo "âœ… Verificando archivos .env..."
        echo "âœ… Verificando configuraciones..."
        echo "âœ… Verificando claves hardcodeadas..."

  # Job de AnÃ¡lisis de Docker
  docker-security:
    name: AnÃ¡lisis de Docker
    runs-on: ubuntu-latest
    continue-on-error: true
    
    steps:
    - name: Checkout cÃ³digo
      uses: actions/checkout@v5
      
    - name: Verificar Dockerfile
      run: |
        echo "ğŸ³ Verificando Dockerfile..."
        if [ -f "Dockerfile" ]; then
          echo "âœ… Dockerfile encontrado"
          echo "ğŸ“‹ Contenido del Dockerfile:"
          cat Dockerfile
        else
          echo "âš ï¸ Dockerfile no encontrado"
        fi
        
    - name: Verificar docker-compose
      run: |
        echo "ğŸ³ Verificando docker-compose..."
        if [ -f "docker-compose.yml" ]; then
          echo "âœ… docker-compose.yml encontrado"
        else
          echo "âš ï¸ docker-compose.yml no encontrado"
        fi

  # Job de Resumen de Seguridad
  security-summary:
    name: Resumen de Seguridad
    runs-on: ubuntu-latest
    needs: [dependency-scan, secret-detection, docker-security]
    continue-on-error: true
    
    steps:
    - name: Checkout cÃ³digo
      uses: actions/checkout@v5
      
    - name: Generar resumen
      run: |
        echo "ğŸ”’ Resumen de AnÃ¡lisis de Seguridad"
        echo "=================================="
        echo ""
        echo "âœ… AnÃ¡lisis de dependencias completado"
        echo "âœ… DetecciÃ³n de secretos completada"
        echo "âœ… AnÃ¡lisis de Docker completado"
        echo ""
        echo "ğŸ“Š Reportes disponibles en la pestaÃ±a Actions"
        echo "ğŸ” Revisa los reportes para identificar vulnerabilidades"
        echo ""
        echo "ğŸš€ Recomendaciones:"
        echo "- Actualiza dependencias vulnerables"
        echo "- Revisa el cÃ³digo en busca de secretos hardcodeados"
        echo "- Optimiza el Dockerfile para seguridad" 